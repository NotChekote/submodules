#!/usr/bin/env bash

set -euo pipefail

root="$( cd "$( dirname "${BASH_SOURCE[0]}" )/../../" && pwd )"

. get_tty
. "$root/docker/lib/volumes.sh"
. "$root/submodules/lib/docker_host_user_id.sh"

# note: The .gitconfig mount cannot use a Docker Volume since it is a file, not a dir.
docker run \
    -e LOCAL_USER_ID="$DOCKER_HOST_USER_ID" \
    -i \
    $TTY \
    -v ~/.gitconfig:/home/user/.gitconfig:delegated \
    --mount source="$PROJECT_VOLUME",target=/workdir \
    --mount source=user_ssh,target=/home/user/.ssh \
    --mount source=user_config,target=/home/user/.config \
    --rm \
    chekote/hub:2.14.2 "$@"
